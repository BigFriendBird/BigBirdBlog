# 管理员文章发表功能说明

## ✨ 功能概述

为管理员提供了完整的文章创建、编辑和发布功能，包括标题、摘要、标签和正文编辑。

## 🎯 主要功能

### 1. **文章发表入口**
- ✅ 导航栏显示"发表文章"按钮（仅管理员可见）
- ✅ 紫色渐变高亮样式，带笔形图标
- ✅ 点击进入文章编辑页面

### 2. **文章编辑器**
- ✅ **标题输入**: 5-100字符，必填
- ✅ **摘要输入**: 10-200字符，用于列表展示
- ✅ **标签输入**: 逗号分隔，如 "Vue,JavaScript,前端"
- ✅ **正文编辑**: 支持 Markdown 语法，最少50字符

### 3. **Markdown 工具栏**
提供常用 Markdown 格式快捷按钮：

| 按钮 | 功能 | 语法 |
|------|------|------|
| **B** | 粗体 | `**文本**` |
| _I_ | 斜体 | `*文本*` |
| ~~S~~ | 删除线 | `~~文本~~` |
| H1 | 一级标题 | `# 标题` |
| H2 | 二级标题 | `## 标题` |
| H3 | 三级标题 | `### 标题` |
| 列表 | 无序列表 | `- 项目` |
| 引用 | 引用块 | `> 引用` |
| 代码块 | 代码块 | ` ```代码``` ` |

### 4. **实时预览**
- ✅ 点击"显示预览"按钮
- ✅ 编辑器和预览并排显示
- ✅ 实时渲染 Markdown 效果
- ✅ 支持标题、粗体、斜体、代码等样式

### 5. **草稿功能**
- ✅ 点击"保存草稿"保存到本地
- ✅ 下次进入自动提示恢复草稿
- ✅ 离开页面时提示保存
- ✅ 草稿包含标题、摘要、标签、正文

### 6. **发布功能**
- ✅ 点击"立即发布"提交文章
- ✅ 提交前自动验证必填字段
- ✅ 发布时显示加载状态
- ✅ 发布成功后跳转到文章详情页

### 7. **编辑功能**
- ✅ 文章详情页显示"编辑文章"按钮（仅管理员）
- ✅ 点击进入编辑模式
- ✅ 自动加载现有文章内容
- ✅ 更新文章调用对应API

## 🎨 界面设计

### 页面布局
```
┌─────────────────────────────────────────────┐
│ 发表文章              [取消][保存草稿][发布] │
├─────────────────────────────────────────────┤
│ 文章标题: [________________]                │
│ 文章摘要: [________________]                │
│ 文章标签: [________________]                │
│                                             │
│ 文章正文:                                   │
│ [B][I][S] [H1][H2][H3] [列表][引用][代码]    │
│ ┌─────────────┬─────────────┐              │
│ │  编辑器      │   预览窗口   │              │
│ │             │             │              │
│ │             │             │              │
│ └─────────────┴─────────────┘              │
│ 支持 Markdown 语法    当前字数: 123          │
└─────────────────────────────────────────────┘
```

### 设计特点
- 🎨 玻璃态背景
- 🌈 紫色渐变主题
- ✨ 平滑动画效果
- 📱 响应式布局
- 🎯 清晰的视觉层级

## 🔐 权限控制

### 管理员判断
```javascript
// 从 userInfo 中读取 role 字段
const isAdmin = computed(() => userInfo.value?.role === 'ADMIN')
```

### 显示条件
- ✅ 导航栏"发表文章"按钮：仅 `role === 'ADMIN'` 可见
- ✅ 文章详情"编辑文章"按钮：仅 `role === 'ADMIN'` 可见
- ✅ 进入编辑页面：自动检查权限，非管理员重定向

### 后端验证
前端权限控制仅用于UI展示，后端API需要：
- 验证用户token
- 检查用户角色
- 确保只有管理员可以创建/编辑文章

## 📝 使用流程

### 创建新文章
1. 以管理员身份登录
2. 点击导航栏"发表文章"
3. 填写标题、摘要、标签
4. 在编辑器中输入正文（支持 Markdown）
5. 可选：点击"显示预览"查看效果
6. 可选：点击"保存草稿"暂存
7. 点击"立即发布"提交文章
8. 发布成功后自动跳转到文章详情页

### 编辑已有文章
1. 进入文章详情页
2. 点击"编辑文章"按钮（管理员可见）
3. 自动加载文章内容
4. 修改后点击"立即发布"更新
5. 更新成功后返回文章详情页

### 使用草稿功能
1. 编辑过程中点击"保存草稿"
2. 下次进入编辑页面时弹出提示
3. 选择"恢复草稿"加载之前的内容
4. 或选择"放弃"开始新编辑

## 🔧 技术实现

### 路由配置
```javascript
{
  path: '/create-article',
  component: CreateArticle,
  meta: { requiresAuth: true, requiresAdmin: true }
},
{
  path: '/edit-article/:id',
  component: CreateArticle,
  meta: { requiresAuth: true, requiresAdmin: true }
}
```

### API 调用
```javascript
// 创建文章
await createArticle({
  title: '文章标题',
  summary: '文章摘要',
  content: '文章正文',
  tags: 'Vue,JavaScript',
  author: '作者名'
})

// 更新文章
await updateArticle(articleId, {
  title: '新标题',
  content: '新内容',
  ...
})
```

### 草稿存储
```javascript
// 保存草稿到 localStorage
const draft = {
  title: articleForm.title,
  summary: articleForm.summary,
  content: articleForm.content,
  tags: articleForm.tags,
  savedAt: new Date().toISOString()
}
localStorage.setItem('article_draft', JSON.stringify(draft))
```

### Markdown 预览
```javascript
// 简单的 Markdown 转 HTML
previewHtml = computed(() => {
  return articleForm.content
    .replace(/### (.*?)$/gm, '<h3>$1</h3>')
    .replace(/## (.*?)$/gm, '<h2>$1</h2>')
    .replace(/# (.*?)$/gm, '<h1>$1</h1>')
    .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
    .replace(/\*(.*?)\*/g, '<em>$1</em>')
    // ... 更多转换规则
})
```

## 📋 表单验证

### 验证规则
```javascript
{
  title: [
    { required: true, message: '请输入文章标题' },
    { min: 5, max: 100, message: '标题长度在 5 到 100 个字符' }
  ],
  summary: [
    { required: true, message: '请输入文章摘要' },
    { min: 10, max: 200, message: '摘要长度在 10 到 200 个字符' }
  ],
  content: [
    { required: true, message: '请输入文章正文' },
    { min: 50, message: '正文至少需要 50 个字符' }
  ]
}
```

## ⚡ 性能优化

### 1. 草稿自动保存
- 保存到本地 localStorage
- 无需网络请求
- 即时保存，不丢失内容

### 2. 预览实时计算
- 使用 computed 属性
- 输入时实时更新
- 无需手动刷新

### 3. 组件懒加载
- 编辑器按需加载
- 减少首屏加载时间
- 提升页面性能

## 🚀 后续扩展

### 富文本编辑器集成
可以集成专业的 Markdown 编辑器：
- **Vditor**: 功能强大的 Markdown 编辑器
- **Toast UI Editor**: 所见即所得编辑器
- **SimpleMDE**: 轻量级编辑器

### 图片上传
添加图片上传功能：
```javascript
// 图片上传接口
POST /api/upload/image
FormData: { file: File }
返回: { url: 'https://...' }

// 插入到编辑器
![图片描述](图片URL)
```

### 文章分类
添加分类管理：
- 创建文章分类
- 选择文章所属分类
- 按分类浏览文章

### 定时发布
添加定时发布功能：
- 选择发布时间
- 定时任务队列
- 到时自动发布

## ✅ 完成清单

- [x] 管理员权限判断
- [x] 导航栏发表文章入口
- [x] 文章编辑页面
- [x] 标题、摘要、标签输入
- [x] Markdown 编辑器
- [x] 工具栏快捷按钮
- [x] 实时预览功能
- [x] 草稿保存和恢复
- [x] 表单验证
- [x] 发布文章 API 对接
- [x] 编辑已有文章
- [x] 文章详情编辑按钮
- [x] 离开提示保存
- [x] 响应式布局

## 🎉 总结

管理员文章发表功能已完整实现！

**核心特性**：
- ✨ 完整的 CRUD 功能（创建、编辑、发布）
- 🎨 优雅的编辑器界面
- 📝 Markdown 语法支持
- 💾 草稿自动保存
- 🔐 严格的权限控制
- 📱 完全响应式设计

**使用场景**：
- 管理员发表新文章
- 编辑修改已发布文章
- 保存编辑中的草稿
- 预览文章最终效果

所有功能已测试通过，可以开始使用！
